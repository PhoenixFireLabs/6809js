module("Syntax and coding standards");jsHintTest("JSHint","../6809.js");module("Basic tests");test("Namespace",function(){notEqual(CPU6809,null,"CPU6809 is defined");
equal(typeof(CPU6809),"object","CPU6809 is an object");});module("Simple OP tests");var RAM=[0,2,85];var byteAt=function(a){return RAM[a];};var byteTo=function(b,a){RAM[b]=a;
};test("Reset",function(){CPU6809.init(byteTo,byteAt,null);var a=(CPU6809.status());equal(a.dp,0,"Reset");});test("Flags",function(){RAM=[29];CPU6809.init(byteTo,byteAt,null);
CPU6809.set("flags",255);var a=(CPU6809.status());equal(a.flags,255,"Flags");});test("Simple op",function(){RAM=[0,2,85];CPU6809.init(byteTo,byteAt,null);
CPU6809.set("pc",0);CPU6809.steps(1);var a=(CPU6809.status());equal(a.pc,2,"PC");equal(RAM[2],171,"Operation");equal(a.flags&15,9,"Flags NC");equal(CPU6809.T(),6,"Timer");
});test("Simple op - extended",function(){RAM=[112,0,3,85];CPU6809.init(byteTo,byteAt,null);CPU6809.set("pc",0);CPU6809.steps(1);var a=(CPU6809.status());
equal(a.pc,3,"PC");equal(RAM[3],171,"Operation");equal(a.flags&15,9,"Flags NC");equal(CPU6809.T(),7,"Timer");});test("Simple op 2",function(){RAM=[4,2,171];
CPU6809.init(byteTo,byteAt,null);CPU6809.set("pc",0);CPU6809.steps(1);var a=(CPU6809.status());equal(a.pc,2,"PC");equal(RAM[2],85,"Operation");equal(a.flags&13,1,"Flags C");
equal(CPU6809.T(),6,"Timer");});test("SEX",function(){RAM=[29];CPU6809.init(byteTo,byteAt,null);CPU6809.set("b",170);CPU6809.set("flags",255);CPU6809.set("pc",0);
CPU6809.steps(1);var a=(CPU6809.status());equal(a.pc,1,"PC");equal(a.a,255,"A");equal(a.flags&15,9,"Flags C");equal(CPU6809.T(),2,"Timer");});test("EXG",function(){RAM=[30,137];
CPU6809.init(byteTo,byteAt,null);CPU6809.set("a",170);CPU6809.set("b",85);CPU6809.set("pc",0);CPU6809.steps(1);var a=(CPU6809.status());equal(a.pc,2,"PC");
equal(a.a,85,"A");equal(a.b,170,"A");equal(CPU6809.T(),8,"Timer");});test("TFR",function(){RAM=[31,137];CPU6809.init(byteTo,byteAt,null);CPU6809.set("a",170);
CPU6809.set("b",85);CPU6809.set("pc",0);CPU6809.steps(1);var a=(CPU6809.status());equal(a.pc,2,"PC");equal(a.a,170,"A");equal(a.b,170,"A");equal(CPU6809.T(),6,"Timer");
});test("LEAX ,s++",function(){RAM=[48,225];CPU6809.init(byteTo,byteAt,null);CPU6809.set("sp",120);CPU6809.set("pc",0);CPU6809.steps(1);var a=(CPU6809.status());
equal(a.pc,2,"PC");equal(a.sp,122,"SP");equal(a.x,120,"X");equal(CPU6809.T(),7,"Timer");});module("Simple BRA tests");test("BRA - relative addr 1",function(){RAM=[32,254];
CPU6809.init(byteTo,byteAt,null);CPU6809.set("pc",0);CPU6809.steps(1);var a=(CPU6809.status());equal(a.pc,0,"PC");equal(CPU6809.T(),3,"Timer");});test("LBRA - relative addr 1",function(){RAM=[22,255,253];
CPU6809.init(byteTo,byteAt,null);CPU6809.set("pc",0);CPU6809.steps(1);var a=(CPU6809.status());equal(a.pc,0,"PC");equal(CPU6809.T(),5,"Timer");});test("LBRA - relative addr 0",function(){RAM=[22,0,0];
CPU6809.init(byteTo,byteAt,null);CPU6809.set("pc",0);CPU6809.steps(1);var a=(CPU6809.status());equal(a.pc,3,"PC");equal(CPU6809.T(),5,"Timer");});test("LBSR - relative addr 1",function(){RAM=[23,255,253];
CPU6809.init(byteTo,byteAt,null);CPU6809.set("SP",6);CPU6809.set("pc",0);CPU6809.steps(1);var a=(CPU6809.status());equal(RAM[4]*256+RAM[5],3,"Stack push");
equal(a.pc,0,"PC");equal(CPU6809.T(),9,"Timer");});test("LBSR - relative addr 0",function(){RAM=[23,0,0];CPU6809.init(byteTo,byteAt,null);CPU6809.set("SP",6);
CPU6809.set("pc",0);CPU6809.steps(1);var a=(CPU6809.status());equal(RAM[4]*256+RAM[5],3,"Stack push");equal(a.pc,3,"PC");equal(CPU6809.T(),9,"Timer");});
module("Push / pop");test("PSHS",function(){RAM=[52,6];CPU6809.init(byteTo,byteAt,null);CPU6809.set("SP",6);CPU6809.set("a",170);CPU6809.set("b",85);CPU6809.set("pc",0);
CPU6809.steps(1);var a=(CPU6809.status());equal(RAM[4],170,"Stack push");equal(RAM[5],85,"Stack push");equal(a.pc,2,"PC");equal(a.sp,4,"SP");equal(CPU6809.T(),7,"Timer");
});test("PULS",function(){RAM=[53,6,0,0,170,85];CPU6809.init(byteTo,byteAt,null);CPU6809.set("SP",4);CPU6809.set("a",0);CPU6809.set("b",0);CPU6809.set("pc",0);
CPU6809.steps(1);var a=(CPU6809.status());equal(a.a,170,"Reg A");equal(a.b,85,"Reg B");equal(a.pc,2,"PC");equal(a.sp,6,"SP");equal(CPU6809.T(),7,"Timer");
});module("Extended opcodes");test("LDY imm",function(){RAM=[16,142,18,52];CPU6809.init(byteTo,byteAt,null);CPU6809.set("pc",0);CPU6809.steps(1);var a=(CPU6809.status());
equal(a.pc,4,"PC");equal(a.y,4660,"Y reg");equal(CPU6809.T(),4,"Timer");});test("LDY extended",function(){RAM=[16,190,0,1];CPU6809.init(byteTo,byteAt,null);
CPU6809.set("pc",0);CPU6809.steps(1);var a=(CPU6809.status());equal(a.pc,4,"PC");equal(a.y,48640,"Y reg");equal(a.flags&14,8,"Flags Nzv");equal(CPU6809.T(),7,"Timer");
});